## SQL 옵티마이저란?

사용자가 작성한 SQL을 가장 효율적인 실행계획으로 변환하는 데이터베이스의 핵심 엔진이다. 쿼리를 그대로 실행하지 않고 옵티마이저가 여러 실행 방법 중 가장 빠를 것으로 예상되는 계획을 선택한다.

## 옵티마이저의 종류

**규칙 기반 옵티마이저 (RBO, Rule-Based Optimizer)**

- 오래된 방식, **미리 정해진 우선순위**에 따라 실행 계획을 결정함.
- ex. 인덱스를 쓰는 것이 항상 테이블 풀 스캔보다 먼저

**비용 기반 옵티마이저 (CBO, Cost-Based Optimizer)**

- 통계 정보를 기반으로 **각 실행 계획의 비용을 계산하여 가장 낮은 비용을 선택**
- 현재 대부분의 데이터베이스에서 사용
- 통계 정보(테이블 건수, 인덱스 카디널리티 등)가 매우 중요함

## 옵티마이저의 핵심 요소

1. 통계 정보: 테이블/인덱스 건수, 데이터 분포, 컬럼 값 범위 등 사용
2. 비용 모델: 실행 계획마다 예상되는 리소스 사용량(디스크 i/o, cpu 소모 등)을 숫자로 계산하여 가장 낮은 비용의 실행 계획 선택
3. 힌트: 옵티마이저의 선택을 강제할 수 있는 수단

## SQL 튜닝에서 옵티마이저 이해가 중요한 이유

- 실행 계획은 SQL 성능에 직결됨.
- 옵티마이저가 잘못된 계획을 세우는 경우(통계 불일치, 편향된 데이터 분포 등)가 많음.
- 따라서 SQL 튜닝 시
    1. 옵티마이저가 어떤 기준으로 판단했는지
    2. 통계 정보가 정확한지
    3. 힌트나 구조 변경이 필요한지

를 판단해야 한다.

## 옵티마이저의 한계 및 개발자의 역할

최적의 실행 계획을 계산하기 위해 완벽한 통계 정보를 얻는 것은 힘들다. 옵티마이저도 사람이 개발했기 때문에 개발자는 DBMS를 이해하고 사용하는 것이 필요하다.

**필요한 최소 블록만 읽도록 쿼리 작성**

함수 호출, 조인 등 불필요한 컬럼에 적용하지 않도록 주의하자.

**최적의 옵티마이징 팩터 제공**

SQL 조건절을 기준으로 전략적인 인덱스를 구성하자. 파티션, 클러스터, IOT 등 DBMS가 제공하는 다양한 기능을 활용하자.

**필요하다면 옵티마이저 힌트를 사용해 최적의 엑세스 경로로 유도**

최적으로 실행되는 쿼리라도 필요한 경우라면 힌트를 명시하자

## 튜닝 전문가 되는 공부 방법

보통 아래 세 가지로 나뉜다.

- SQL 튜닝: I/O 최적화, DB Call 최적화, SQL 파싱 최적화
- DB 설계: 논리적 데이터 구조 설계, 물리적 저장 구조 설계
- 인스턴스 튜닝: Lock/Latch 모니터링 및 해소, 메모리 설정, 프로세스 설정 등

튜닝 전문가가 되려면 SQL을 깊이 이해하고, 좋은 데이터 구조를 설계하는 것이 가장 중요하다.

## 정리

- 옵티마이저는 SQL 성능의 핵심: **어떤 실행 계획을 선택하는가?**
- 통계 정보가 정확해야 옵티마이저가 올바른 선택을 함.
- 옵티마이저의 의사결정 요소(비용, 조인 순서, 인덱스 사용)를 이해하면 SQL 튜닝이 쉬워짐.
